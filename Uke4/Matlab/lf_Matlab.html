<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Løsningsforslag til implementering av histogramtilpasning i Matlab">

<title>Løsningsforslag til implementering av histogramtilpasning i Matlab</title>

<!-- Bootstrap style: bootswatch_yeti -->
<link href="https://netdna.bootstrapcdn.com/bootswatch/3.1.1/yeti/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }

/* Add scrollbar to dropdown menus in bootstrap navigation bar */
.dropdown-menu {
   height: auto;
   max-height: 400px;
   overflow-x: hidden;
}

/* Adds an invisible element before each target to offset for the navigation
   bar */
.anchor::before {
  content:"";
  display:block;
  height:45px;      /* fixed header height for style bootswatch_yeti */
  margin:-45px 0 0; /* negative fixed header height */
}

body { font-size:16px; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Table of contents',
               1,
               'table_of_contents',
               'table_of_contents'),
              ('Oppgave 6', 1, None, '___sec0'),
              ('Oppgave 3', 1, None, '___sec1')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="lf_Matlab.html">Løsningsforslag til implementering av histogramtilpasning i Matlab</a>
  </div>

  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#table_of_contents" style="font-size: 14px; padding: 4px 15px;">Table of contents</a></li>
     <!-- navigation toc: --> <li><a href="#___sec0" style="font-size: 14px; padding: 4px 15px;">Oppgave 6</a></li>
     <!-- navigation toc: --> <li><a href="#___sec1" style="font-size: 14px; padding: 4px 15px;">Oppgave 3</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<!-- ------------------- main content ---------------------- -->



<div class="jumbotron">
<center><h1>L&#248;sningsforslag til implementering av histogramtilpasning i Matlab</h1></center>  <!-- document title -->

<p>
</div> <!-- end jumbotron -->

<h1 id="table_of_contents">Table of contents</h2>

<p>
<a href="#___sec0"> Oppgave 6 </a><br>
<a href="#___sec1"> Oppgave 3 </a><br>
</p>
<p>
<!-- !split -->

<h1 id="___sec0" class="anchor">Oppgave 6 </h1>
<p>

<!-- code=matlab (!bc mpro) typeset with pygments style "friendly" -->
<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span><span style="color: #60a0b0; font-style: italic">% histogramtilpasning(img,q)</span>
<span style="color: #60a0b0; font-style: italic">% Histogramtilpasser et innbilde img til et gitt histogram q.</span>
<span style="color: #60a0b0; font-style: italic">%</span>
<span style="color: #60a0b0; font-style: italic">% Argumenter:</span>
<span style="color: #60a0b0; font-style: italic">%   * img: Bildet som skal histogramtilpasses.</span>
<span style="color: #60a0b0; font-style: italic">%   * q: Det normaliserte histogrammet img skal tilpasses til.</span>
<span style="color: #60a0b0; font-style: italic">% Returnerer:</span>
<span style="color: #60a0b0; font-style: italic">%   * img_T: Det histogramtilpassede bildet. </span>
<span style="color: #007020; font-weight: bold">function</span><span style="color: #bbbbbb"> </span>img_T =<span style="color: #bbbbbb"> </span><span style="color: #06287e">histogramtilpasning</span>(img,q)<span style="color: #bbbbbb"></span>

<span style="color: #bbbbbb">    </span><span style="color: #60a0b0; font-style: italic">% Antar 8-bit</span>
    G = <span style="color: #40a070">256</span>;

    <span style="color: #60a0b0; font-style: italic">% Finn innbildets histogram og deretter dets kumulative histogram:</span>
    [<span style="color: #666666">~</span>,c] = finn_histogram_bilde(img);

    <span style="color: #60a0b0; font-style: italic">% Finn det kumulative histogrammet til q:</span>
    cq = cumsum(q);
    
    <span style="color: #60a0b0; font-style: italic">% Transformér innbildet img:</span>
    T = <span style="color: #007020">zeros</span>(<span style="color: #40a070">1</span>,G);

    <span style="color: #007020; font-weight: bold">for</span> <span style="color: #007020">i</span>=<span style="color: #40a070">1</span>:G
        [<span style="color: #666666">~</span>,argmin] = min(<span style="color: #007020">abs</span>(c(<span style="color: #007020">i</span>) <span style="color: #666666">-</span> cq));
        T(<span style="color: #007020">i</span>) = argmin<span style="color: #666666">-</span><span style="color: #40a070">1</span>; <span style="color: #60a0b0; font-style: italic">% -1 fordi utbildet skal ha verdier mellom 0 og 255.</span>
    <span style="color: #007020; font-weight: bold">end</span>
    
    [N,M] = <span style="color: #007020">size</span>(img);
    img_T = <span style="color: #007020">zeros</span>(N,M);
    
    <span style="color: #007020; font-weight: bold">for</span> <span style="color: #007020">i</span>=<span style="color: #40a070">1</span>:N
        <span style="color: #007020; font-weight: bold">for</span> <span style="color: #007020">j</span>=<span style="color: #40a070">1</span>:M
            img_T(<span style="color: #007020">i</span>,<span style="color: #007020">j</span>) = T(img(<span style="color: #007020">i</span>,<span style="color: #007020">j</span>)<span style="color: #666666">+</span><span style="color: #40a070">1</span>); <span style="color: #60a0b0; font-style: italic">% +1 fordi img(i,j) er mellom 0 og 255. </span>
                                        <span style="color: #60a0b0; font-style: italic">% Null er ikke gyldig indeks i Matlab. </span>
        <span style="color: #007020; font-weight: bold">end</span>
    <span style="color: #007020; font-weight: bold">end</span>

<span style="color: #007020; font-weight: bold">end</span>
</pre></div>
<p>
Koden kan lastes ned <a href="https://github.com/krisbhei/INF2310/blob/master/Uke4/Matlab/histogramtilpasning.m" target="_self">her</a>.
Programmet bruker ogs&#229; en egendefinert funksjon for &#229; finne bildets histogram (finn_histogram_bilde).
Den kan lastes ned <a href="https://github.com/krisbhei/INF2310/blob/master/Uke4/Matlab/finn_histogram_bilde.m" target="_self">her</a>.
<br />
Id&#233;en bak algoritmen tatt direkte fra slide 14 i <a href="http://www.uio.no/studier/emner/matnat/ifi/INF2310/v18/undervisningsmateriale/20180214_histogrambaserteoperasjoner.pdf" target="_self">lysarket om histogrambaserte operasjoner</a>.

<p>
For &#229; sjekke om programmet faktisk utf&#248;rer en histogramtilpasning, har det blitt skrevet et eksempelprogram:
<p>

<!-- code=matlab (!bc mpro) typeset with pygments style "friendly" -->
<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span>G = <span style="color: #40a070">256</span>;
intensiteter = <span style="color: #007020">linspace</span>(<span style="color: #40a070">0</span>,G<span style="color: #666666">-</span><span style="color: #40a070">1</span>,G);

img = imread(<span style="color: #4070a0">&#39;mona.png&#39;</span>);

gauss = @(x,mu,std) <span style="color: #007020">exp</span>(<span style="color: #666666">-</span><span style="color: #40a070">0.5</span><span style="color: #666666">.*</span>((x<span style="color: #666666">-</span>mu)<span style="color: #666666">./</span>std)<span style="color: #666666">.^</span><span style="color: #40a070">2</span>)<span style="color: #666666">./</span><span style="color: #007020">sqrt</span>(<span style="color: #40a070">2</span><span style="color: #666666">*</span><span style="color: #007020">pi</span><span style="color: #666666">*</span>std^<span style="color: #40a070">2</span>);
mu = input(<span style="color: #4070a0">&#39;Middelverdi = &#39;</span>);
std_ = input(<span style="color: #4070a0">&#39;Standardavvik = &#39;</span>);

q = gauss(intensiteter,mu,std_);
q = q<span style="color: #666666">./</span>sum(q);

img_T = histogramtilpasning(img,q);


fprintf(<span style="color: #4070a0">&#39;Sum av ønsket histogram: %g\n&#39;</span>,sum(q));
fprintf(<span style="color: #4070a0">&#39;Middelverdi til transformert bilde: %g\n&#39;</span>,mean2(img_T));
fprintf(<span style="color: #4070a0">&#39;Standardavvik til transformert bilde: %g\n&#39;</span>,std2(img_T));


plot_histogramtransformert(img,img_T,q)
</pre></div>
<p>
som kan lastes ned <a href="https://github.com/krisbhei/INF2310/blob/master/Uke4/Matlab/oppgave6_Gauss_demo.m" target="_self">her</a>.

<p>
Programmet tilpasser et gitt bilde, i dette tilfellet av Mona, til et Gaussisk histogram.
Et Gaussisk histogram ble bare valgt som demonstrasjon, men det er fullt mulig &#229; bruke andre former p&#229; det &#248;nskede histogrammet.

<p>
Etter en kj&#248;ring av programmet med middelverdi = 128 og standardavvik = 20, blir resultatet slik:

<p>
<center>  <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 1:  Mona som har blitt histogramtilpasset en Gauss med middelverdi lik 128 og standardavvik p&#229; 20. </p></center>
<p><img src="mona_Gauss_tilpasset_M.svg" align="bottom" width=1000></p>
</center>

<p>
Programmet bruker en egen plottefunksjon (plot_histogramtransformert) som kan lastes ned <a href="https://github.com/krisbhei/INF2310/blob/master/Uke4/Matlab/plot_histogramtransformert.m" target="_self">her</a>.

<p>
Programmet sjekker ogs&#229; om middelverdien og standardavviket i det transformerte bildet er omtrent lik
middelverdien og standardavviket til Gauss-en:

<p>

<!-- code=text typeset with pygments style "friendly" -->
<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span>Sum av ønsket histogram: 1
Middelverdi til transformert bilde: 127.768
Standardavvik til transformert bilde: 19.9696
</pre></div>
<p>
Som en kan se, sjekker den ogs&#229; om det &#248;nskede histogrammet er normalisert - alts&#229; summeres opp til &#233;n. Dette er en ganske viktig forutsetning for at transformen skal v&#230;re s&#229; god som mulig!

<h1 id="___sec1" class="anchor">Oppgave 3 </h1>
N&#229; som en funksjon som generell histogramtilpasning har blitt definert i oppgave 6, er det bare &#229; bruke den samme funksjonen for &#229; utf&#248;re en histogramutjeving:
<p>

<!-- code=matlab (!bc mpro) typeset with pygments style "friendly" -->
<div class="highlight" style="background: #f0f0f0"><pre style="line-height: 125%"><span></span>G = <span style="color: #40a070">256</span>;
intensiteter = <span style="color: #007020">linspace</span>(<span style="color: #40a070">0</span>,G<span style="color: #666666">-</span><span style="color: #40a070">1</span>,G);

img = imread(<span style="color: #4070a0">&#39;mona.png&#39;</span>);

uniform = @(G) <span style="color: #007020">ones</span>(<span style="color: #40a070">1</span>,G)<span style="color: #666666">./</span>G;
q = uniform(G);

img_T = histogramtilpasning(img,q);

plot_histogramtransformert(img,img_T,q)
</pre></div>
<p>
Programmet kan lastes ned <a href="https://github.com/krisbhei/INF2310/blob/master/Uke4/Matlab/oppgave3.m" target="_self">her</a>.

<p>
Programmet gir dette som resultat:

<p>
<center>  <!-- FIGURE -->
<hr class="figure">
<center><p class="caption">Figure 2:  Bilde av Mona som har blitt histogramutjevnet. </p></center>
<p><img src="mona_utjevnet.svg" align="bottom" width=800></p>
</center>

<p>
Det ogs&#229; er fullt mulig &#229; l&#248;se denne oppgaven ved &#229; direkte spesifisere hva uttrykket for det kumulative histogrammet er til et uniformt histogram.
Uttrykket for det kumulative histogrammet vil bli
$$
\begin{align*}
c(j) &= \frac{T(j)}{G}\\
G \cdot c(j) &= T(j)
\end{align*}
$$

Dette betyr at den diskrete transformasjonen blir
$$
T[j] = \text{round}((G-1)\cdot c[j])
$$

Da er det mulig &#229; implementere dette uttrykket direkte for &#229; finne transformasjonsarray-et til bildet.
Dette er beskrevet mer detaljert p&#229; slide 8 i <a href="http://www.uio.no/studier/emner/matnat/ifi/INF2310/v18/undervisningsmateriale/20180214_histogrambaserteoperasjoner.pdf" target="_self">lysarket om histogrambaserte operasjoner</a>.

<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


<center style="font-size:80%">
<!-- copyright -->  Made with <a href="https://github.com/hplgit/doconce">DocOnce</a>
</center>


</body>
</html>
    

